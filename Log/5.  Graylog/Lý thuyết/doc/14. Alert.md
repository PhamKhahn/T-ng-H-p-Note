# 1. Alerts
Alert được tạo bằng việc sử dụng Event Definitions (bao gồm bên trong là Conditions)
- Khi 1 condition được đáp ứng -> lưu dưới dạng Event và có thế được sử dụng để kích hoạt thông báo
- Nếu hệ thống có enterprise license, các Event có thể kết hợp lại để tạo Correlations

# 2. Alerts & Events
- 1 Alert được kích hoạt khi 1 Event được dectect.
- 1 Alert là 1 condition mà khớp với log trong 1 khoảng thời gian hoặc toàn bộ
- Event có thể được dùng để nhóm các field tương tự; thay đổi nội dung field; tạo field mới để sử dụng với việc Cản Báo hay tạo Tương Quan (tính năng enterprise)

# 3. Defining an Event
## 3.1 Event Details
- Click vào "Getting Started" (Chưa có event nào)
![Imgur](https://i.imgur.com/UoWhIPD.png)
Cho phép set:
- title
- description
- priority
![Imgur](https://i.imgur.com/ixkydqW.png)

## 3.2 Filter & Aggregation (Lọc và tổng hợp)
### 3.2.1 Filter
- Kết hợp Filter và Aggregation -> mô tả cụ thể tiêu chí,tiêu chuẩn của Event
- Define a Filter bằng việc sử dụng Search Query kèm theo cú pháp chính xác ở Search page.
- Chọn 1 Stream mà ở đó message có thể được tìm thấy. Xác định rõ range thời gian mà Filter sẽ thực hiện tìm kiếm để khớp các message.
- Nếu Filter match, 1 Event có thể được tạo. Tuy nhiện việc tăng dữ liệu được lọc bằng 1 Aggregation có thể khá hữu ích

![Imgur](https://i.imgur.com/VxwayrL.png)

![Imgur](https://i.imgur.com/mgTy7DY.png)

- Nếu Filter được define mà match messages thì sẽ hiển thị ở bên phải

### Aggregation (Tập hợp,Tổng hợp)
1 Aggregation 
- có thể chạy 1 phép toán trên giá trị của Field dạng số (a numberic field) hay lượng mess thô được match bởi Filter

- có thể nhóm các kết quả khớp theo 1 Field đã chọn trước khi thực hiện so sánh

Ví dụ: Field username đã được define, ta có thể alert về năm lần login thất bại từ 1 username cụ thể

![Imgur](https://i.imgur.com/VVWqwpY.png)
![Imgur](https://i.imgur.com/L6Yq4d6.png)

- 1 phút thực hiện search 1 lần 
- range 1 tiếng
- Search và match các mess ssh (thông qua stream sshmess) có level (severity của ssh) <=4 ( Từ warning cho đến emergency)
### Field

Tạo các Custom Field cho phép Event đưa dữ liệu từ original log vào Graylog Events index.
--> Giúp người dùng không phải qua lại các page khác để tìm kiếm

### Notifications

Xác định Event để kích hoạt Alert -> chỉ định cách thức, thời điểm thông báo được gửi đi từ Graylog

![Imgur](https://i.imgur.com/ERlSece.png)
![Imgur](https://i.imgur.com/NVtwUbV.png)


Có 3 loại noti
- Email alert notification
- HTTP alert notification
- Legacy Script alert notification

# Cấu hình Alert qua Email (cụ thể Gmail)
## 1. Yêu cầu
Server đã cài package và cấu hình để có thể tự gửi mail
Ví dụ : Postfix (Nhớ mở port cho service .port 25)
## 2. Cấu hình 
### 2.1 Trên server
```
#vi /etc/graylog/server/server.conf

```

Thêm hoặc bỏ comment các dòng và cấu hình như sau:
```
# Email transport
transport_email_enabled = true
transport_email_hostname = smtp.gmail.com
transport_email_port = 587
transport_email_use_auth = true

transport_email_use_tls = true
transport_email_use_ssl = false
transport_email_auth_username = pham.zuk@gmail.com
transport_email_auth_password = passsaiday0choxemdau
transport_email_subject_prefix = [graylog]
transport_email_from_email = pham.zuk@gmail.com
#transport_email_web_interface_url = http://192.168.91.147:9000

```
Các value tùy thuộc thông tin của bản thân, server

**NOTICE**:
- Chỉ dùng 1 trong 2 (tls,ssl) hoặc không dùng cả 2
- Không dùng đồng thời 2 config này

===================================

Khởi động lại graylog
```
systemctl restart graylog-server.service
```

### 2.2 Trên web interface
**Event Details** 
![Imgur](https://i.imgur.com/thK3DeF.png)

**Filter & Aggregation** 
![Imgur](https://i.imgur.com/KH1ZWyr.png)

![Imgur](https://i.imgur.com/mgTy7DY.png)

![Imgur](https://i.imgur.com/L6Yq4d6.png)

**Event Fields**

Chứa thông tin bổ sung trong Events được tạo từ Event Definition này bằng cách thêm các Field tùy chỉnh. Điều đó có thể giúp bạn tìm kiếm các Event hoặc có thêm ngữ cảnh(thông tin thêm) khi nhận các Notification.

**Notifications**
![Imgur](https://i.imgur.com/ERlSece.png)
![Imgur](https://i.imgur.com/NVtwUbV.png)
![Imgur](https://i.imgur.com/GdItVDb.png)
Chỉ định khoảng thời gian xử lý gửi mail

**Event Summary**
Tổng hợp lại các thông tin đã cấu hình



## 3. Kết quả
Nếu thành công, ta có thể nhận được các mail cảnh báo khi Event match các message và điều kiện 

![Imgur](https://i.imgur.com/FtNtOVf.png)
![Imgur](https://i.imgur.com/sr6y17X.png)
![Imgur](https://i.imgur.com/yz6CaOo.png)